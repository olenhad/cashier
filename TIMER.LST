8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    18:26:45  10/17/;2  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  C:\USERS\A0074933\DOCUME~1\13\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2     NAME TIMER
                             3     ; Main program for uPD70208 microcomputer system
                             4     ;
                             5     ; Author:       Dr Tay Teng Tiow
                             6     ; Address:      Department of Electrical Engineering 
                             7     ;               National University of Singapore
                             8     ;               10, Kent Ridge Crescent
                             9     ;               Singapore 0511. 
                            10     ; Date:         6th September 1991
                            11     ;
                            12     ; This file contains proprietory information and cannot be copied 
                            13     ; or distributed without prior permission from the author.
                            14     ; =========================================================================
                            15     
                            16     public  serial_rec_action, timer2_action
                            17     extrn   print_char:far, print_2hex:far, iodefine:far
                            18     extrn   set_timer2:far
                            19     
----                        20     STACK_SEG       SEGMENT
0000 (256                   21                     DB      256 DUP(?)
     ??
     )
0100                        22             TOS     LABEL   WORD
----                        23     STACK_SEG       ENDS
                            24     
                            25     
----                        26     DATA_SEG        SEGMENT
0000 0A                     27             TIMER0_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
0016 2F                     28             T_COUNT         DB      2FH
0017 2F                     29             T_COUNT_SET     DB      2FH
0018 0A                     30             REC_MESS        DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
----                        31     DATA_SEG        ENDS
                            32     
                            33     
----                        34     CODE_SEG        SEGMENT
                            35     
                            36             PUBLIC          START
                            37     
                            38     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            39     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    18:26:45  10/17/;2  PAGE    2


LOC  OBJ                  LINE     SOURCE

0000                        40     START:
                            41     ;initialize stack area
0000 B8----         R       42                     MOV     AX,STACK_SEG            
0003 8ED0                   43                     MOV     SS,AX
0005 368B260001             44                     MOV     SP,TOS
000A B082                   45                     MOV AL, 082H       ;mode 0, A - out, B-in ;changed value of CW from 8
                                   2H
000C BA8300                 46                     MOV DX, 083H ;CWR is sleected
000F EE                     47                     OUT DX, AL      ;send the control word
                            48     ; Initialize the on-chip pheripherals
0010 9A0000----     E       49                     CALL    FAR PTR IODEFINE
                            50                     
                            51     
                            52     
                            53     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
0015 9A0000----     E       54         call set_timer2
001A FB                     55                      STI
                            56     
001B                        57     NEXT:
001B BA8200                 58                     MOV DX, 82H;
001E B055                   59                     MOV AL, 01010101B;
0020 EE                     60                     OUT DX,AL
0021 EBF8                   61          JMP NEXT
                            62     
                            63     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
                            64     
                            65     
0023                        66     SERIAL_REC_ACTION       PROC    FAR
0023 51                     67                     PUSH    CX
0024 53                     68                     PUSH    BX
0025 1E                     69                     PUSH    DS
                            70     
0026 BB----         R       71                     MOV     BX,DATA_SEG             ;initialize data segment register
0029 8EDB                   72                     MOV     DS,BX
                            73     
002B 3C3C                   74                     CMP     AL,'<'
002D 750B                   75                     JNE     S_FAST
                            76     
002F FE061700               77                     INC     DS:T_COUNT_SET
0033 FE061700               78                     INC     DS:T_COUNT_SET
                            79     
0037 EB0D90                 80                     JMP     S_NEXT0
003A                        81     S_FAST:
003A 3C3E                   82                     CMP     AL,'>'
003C 7521                   83                     JNE     S_RET
                            84     
003E FE0E1700               85                     DEC     DS:T_COUNT_SET
0042 FE0E1700               86                     DEC     DS:T_COUNT_SET
                            87     
0046                        88     S_NEXT0:
0046 B91600                 89                     MOV     CX,22                   ;initialize counter for message
0049 BB0000                 90                     MOV     BX,0
                            91     
004C 8A4718                 92     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
004F 9A0000----     E       93                     call    FAR ptr print_char
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    18:26:45  10/17/;2  PAGE    3


LOC  OBJ                  LINE     SOURCE

0054 43                     94                     INC     BX
0055 E2F5                   95                     LOOP    S_NEXT1
                            96     
0057 A01700                 97                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
005A 9A0000----     E       98                     CALL    FAR PTR PRINT_2HEX
005F                        99     S_RET:
005F 1F                    100                     POP     DS
0060 5B                    101                     POP     BX
0061 59                    102                     POP     CX
0062 CB                    103                     RET
                           104     SERIAL_REC_ACTION       ENDP
                           105     
                           106     
                           107     
0063                       108     TIMER2_ACTION   PROC    FAR
0063 50                    109                     PUSH    AX
0064 1E                    110                     PUSH    DS
0065 53                    111                     PUSH    BX
0066 51                    112                     PUSH    CX
                           113     
0067 B8----         R      114                     MOV     AX,DATA_SEG
006A 8ED8                  115                     MOV     DS,AX
                           116             
006C FE0E1600              117                     DEC     DS:T_COUNT
0070 7516                  118                     JNZ     T_NEXT1
0072 A01700                119                     MOV     AL,DS:T_COUNT_SET
0075 A21600                120                     MOV     DS:T_COUNT,AL
                           121     
0078 B91400                122                     MOV     CX,20
007B BB0000                123                     MOV     BX,0H
007E                       124     T_NEXT0:
007E 8A07                  125                     MOV     AL,DS:TIMER0_MESS[BX]
0080 43                    126                     INC     BX
0081 9A0000----     E      127                     CALL    FAR PTR PRINT_CHAR
0086 E2F6                  128                     LOOP    T_NEXT0
                           129     
0088                       130     T_NEXT1:        
0088 59                    131                     POP     CX
0089 5B                    132                     POP     BX
008A 1F                    133                     POP     DS
008B 58                    134                     POP     AX
008C CB                    135                     RET
                           136     TIMER2_ACTION   ENDP
                           137     
                           138     
----                       139     CODE_SEG        ENDS
                           140     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
