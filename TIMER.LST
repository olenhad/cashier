8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    15:10:35  10/25/;2  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  F:\CASHIER\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2     NAME TIMER
                             3     ; Main program for uPD70208 microcomputer system
                             4     ;
                             5     ; Author:       Dr Tay Teng Tiow
                             6     ; Address:      Department of Electrical Engineering 
                             7     ;               National University of Singapore
                             8     ;               10, Kent Ridge Crescent
                             9     ;               Singapore 0511. 
                            10     ; Date:         6th September 1991
                            11     ;
                            12     ; This file contains proprietory information and cannot be copied 
                            13     ; or distributed without prior permission from the author.
                            14     ; =========================================================================
                            15     
                            16     public  serial_rec_action, timer2_action
                            17     extrn   print_char:far, print_2hex:far, iodefine:far
                            18     extrn   set_timer2:far
                            19     
----                        20     STACK_SEG       SEGMENT
0000 (256                   21                     DB      256 DUP(?)
     ??
     )
0100                        22             TOS     LABEL   WORD
----                        23     STACK_SEG       ENDS
                            24     
                            25     
----                        26     DATA_SEG        SEGMENT
0000 0A                     27             TIMER0_MESS     DB      10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
     505420202020
0016 2F                     28             T_COUNT         DB      2FH
0017 2F                     29             T_COUNT_SET     DB      2FH
0018 0A                     30             REC_MESS        DB      10,13,'Period of timer0 =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     7230203D202020
     2020
----                        31     DATA_SEG        ENDS
                            32     
                            33     
----                        34     CODE_SEG        SEGMENT
                            35     
                            36             PUBLIC          START
                            37     
                            38     ASSUME  CS:CODE_SEG, SS:STACK_SEG
                            39     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    15:10:35  10/25/;2  PAGE    2


LOC  OBJ                  LINE     SOURCE

0000                        40     START:
                            41     ;initialize stack area
0000 B8----         R       42                     MOV     AX,STACK_SEG            
0003 8ED0                   43                     MOV     SS,AX
0005 368B260001             44                     MOV     SP,TOS
                            45     
                            46     ; Initialize the on-chip pheripherals
000A 9A0000----     E       47                     CALL    FAR PTR IODEFINE
                            48                     
                            49     
                            50     
                            51     ; ^^^^^^^^^^^^^^^^^  Start of User Main Routine  ^^^^^^^^^^^^^^^^^^
000F 9A0000----     E       52         call set_timer2
0014 FB                     53                      STI
                            54     
0015                        55     NEXT:     
0015 EBFE                   56     JMP NEXT
                            57     
                            58     ; ^^^^^^^^^^^^^^^ End of User main routine ^^^^^^^^^^^^^^^^^^^^^^^^^
                            59     
                            60     
0017                        61     SERIAL_REC_ACTION       PROC    FAR
0017 51                     62                     PUSH    CX
0018 53                     63                     PUSH    BX
0019 1E                     64                     PUSH    DS
                            65     
001A BB----         R       66                     MOV     BX,DATA_SEG             ;initialize data segment register
001D 8EDB                   67                     MOV     DS,BX
                            68     
001F 3C3C                   69                     CMP     AL,'<'
0021 750B                   70                     JNE     S_FAST
                            71     
0023 FE061700               72                     INC     DS:T_COUNT_SET
0027 FE061700               73                     INC     DS:T_COUNT_SET
                            74     
002B EB0D90                 75                     JMP     S_NEXT0
002E                        76     S_FAST:
002E 3C3E                   77                     CMP     AL,'>'
0030 7521                   78                     JNE     S_RET
                            79     
0032 FE0E1700               80                     DEC     DS:T_COUNT_SET
0036 FE0E1700               81                     DEC     DS:T_COUNT_SET
                            82     
003A                        83     S_NEXT0:
003A B91600                 84                     MOV     CX,22                   ;initialize counter for message
003D BB0000                 85                     MOV     BX,0
                            86     
0040 8A4718                 87     S_NEXT1:        MOV     AL,DS:REC_MESS[BX]      ;print message
0043 9A0000----     E       88                     call    FAR ptr print_char
0048 43                     89                     INC     BX
0049 E2F5                   90                     LOOP    S_NEXT1
                            91     
004B A01700                 92                     MOV     AL,DS:T_COUNT_SET       ;print current period of timer0
004E 9A0000----     E       93                     CALL    FAR PTR PRINT_2HEX
0053                        94     S_RET:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    15:10:35  10/25/;2  PAGE    3


LOC  OBJ                  LINE     SOURCE

0053 1F                     95                     POP     DS
0054 5B                     96                     POP     BX
0055 59                     97                     POP     CX
0056 CB                     98                     RET
                            99     SERIAL_REC_ACTION       ENDP
                           100     
                           101     
                           102     
0057                       103     TIMER2_ACTION   PROC    FAR
0057 50                    104                     PUSH    AX
0058 1E                    105                     PUSH    DS
0059 53                    106                     PUSH    BX
005A 51                    107                     PUSH    CX
                           108     
005B B8----         R      109                     MOV     AX,DATA_SEG
005E 8ED8                  110                     MOV     DS,AX
                           111             
0060 FE0E1600              112                     DEC     DS:T_COUNT
0064 7516                  113                     JNZ     T_NEXT1
0066 A01700                114                     MOV     AL,DS:T_COUNT_SET
0069 A21600                115                     MOV     DS:T_COUNT,AL
                           116     
006C B91400                117                     MOV     CX,20
006F BB0000                118                     MOV     BX,0H
0072                       119     T_NEXT0:
0072 8A07                  120                     MOV     AL,DS:TIMER0_MESS[BX]
0074 43                    121                     INC     BX
0075 9A0000----     E      122                     CALL    FAR PTR PRINT_CHAR
007A E2F6                  123                     LOOP    T_NEXT0
                           124     
007C                       125     T_NEXT1:
007C BA0001                126                     MOV DX, 0100H
007F B80100                127                     MOV AX, 01H
0082 EF                    128                     OUT DX, AX
                           129                     
0083 BA8001                130                     MOV DX, 0180H
0086 B87E00                131                     MOV AX, 07EH
0089 EF                    132                     OUT DX, AX
                           133                     
008A 59                    134                     POP     CX
008B 5B                    135                     POP     BX
008C 1F                    136                     POP     DS
008D 58                    137                     POP     AX
008E CB                    138                     RET
                           139     TIMER2_ACTION   ENDP
                           140     
                           141     
----                       142     CODE_SEG        ENDS
                           143     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
